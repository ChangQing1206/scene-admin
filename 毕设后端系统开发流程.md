# 毕设后端系统开发流程

## 技术栈：express + mongodb + ES6 + MD5

### 功能需求

#### 登录注册、历史记录查询、喜好分析

#### 1.创建项目

1.https://blog.csdn.net/weixin_42490398/article/details/90212418  

先创建github仓库，然后在本地目录git init  本地与远程仓库连接   git remote add *yourf仓库name* *git_url*

拉取远程仓库到本地 git pull scene-admin main   编写代码，提交到本地仓库  git commit -m "first commit"

2.先进入项目根目录，npm init 生成package.json 文件  然后npm install express --save  安装express框架

然后npx express-generator 安装骨架生成器

3.安装mongoose 相当于sequelize  npm install mongoose --save

4.安装加密 encryto command: npm install encryto --save  安装 formidable   安装 time-formater  安装 express-session 

5.mosca的backend可选redis,mongo等，其实现选择了ascoltatori进行了redis，Mongo等适配兼容。于是下载了ascoltatori的源码查看了mongo部分的源码，发现其实现是使用了mongodb的固定集合。固定集合的特点是事先决定了该集合的文档数，容量大小，以及如果超出了容量，则最新数据覆盖掉最早的数据，类似循环队列。源码里面的设定的文档条数是10000条，最大容量是10MB.根据任务书第六条，<u>数据记录与查询：可以记录和查询近几天游客的相关信息，包括游客基本信息、体温、游览景点数据等</u>。 如果按照每个游客一分钟更新一次数据，一天景区接待游客3000个，景区开放时长8个小时，则一天产生的数据量：1 * 60 * 8 * 3000 = 1440000 条数据 假如数据需要查询近3天的，则需要保存三天的数据 5120000条数据。所以还是**在mosca server里面操作mongo比较好。 mosca 还可以采用集成方式放在express里面 ，这其实跟之前通过http请求，进而发起socket连接类似**。

6.将mosca server集成到express 。定义 mosca 暴露 server  将数据插入  查询时聚合查询 索引查询 

MongoDB 中聚合(aggregate)主要用于处理数据(诸如统计平均值，求和等)，并返回计算后的数据结果 

使用limit 完成分页查询 

#### 2.历史记录查询及喜好分析

1.游客数据查询

- 显示：游客姓名、游客性别、游客体温、游客日期。编辑操作，删除操作。展开后，还有消费过的商品。经纬度生成路径，到过的景点。
- 一页20条数据，也就是20个游客。
- 可以按天查询，数据库只保存了近5天的数据。因为物联网数据的海量性，决定了不可能长时间保存。

2.游客位置分析

分析出游客的景点路径，游客去过的景点次数，停留时间

3.游客消费分析

游客喜欢消费的商品，游客消费最多的价格区间